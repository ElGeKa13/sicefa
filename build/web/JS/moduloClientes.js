var clientes = [];


function crearClientes() {

    let persona1 = {
        "idPersona": 1,
        "nombre": "Miguel Angel",
        "apellidoPaterno": "Lopez",
        "apellidoMaterno": "Gaeta",
        "genero": "Masculino",
        "fechaNacimiento": "12/09/2001",
        "rfc": "LOGM010912H12",
        "curp": "LOGM010912HGTPTGA5",
        "domicilio": "Neurfar 102",
        "codigoPostal": "37357",
        "ciudad": "León",
        "estado": "Guanajuato",
        "telefono": "4773421119",
        "foto": "foto"
    };

    let cliente1 = {
        "idCliente": 1,
        "fechaRegistro": "09/08/2023",
        "correo": "gaetamiguel31@gmail.com",
        "activo": 1,
        "persona": persona1
    };

    let persona2 = {
        "idPersona": 2,
        "nombre": "Liliana",
        "apellidoPaterno": "Hernandez",
        "apellidoMaterno": "Funes",
        "genero": "Femenino",
        "fechaNacimiento": "06/06/1983",
        "rfc": "HEFL830606",
        "curp": "HEFL830606MGTRML02",
        "domicilio": "Del Santuario 317",
        "codigoPostal": "37357",
        "ciudad": "León",
        "estado": "Guanajuato",
        "telefono": "4772600304",
        "foto": "foto"
    };

    let cliente2 = {
        "idCliente": 2,
        "fechaRegistro": "09/09/2023",
        "correo": "lily060683@gmail.com",
        "activo": 1,
        "persona": persona2
    };

    let persona3 = {
        "idPersona": 3,
        "nombre": "Alejandro",
        "apellidoPaterno": "Arellano",
        "apellidoMaterno": "Lopez",
        "genero": "Masculino",
        "fechaNacimiento": "11/09/2004",
        "rfc": "ARLA040911",
        "curp": "ARLA040911LPAA1",
        "domicilio": "Aguazul 311",
        "codigoPostal": "37251",
        "ciudad": "León",
        "estado": "Guanajuato",
        "telefono": "4773421129",
        "foto": "foto"
    };

    let cliente3 = {
        "idCliente": 3,
        "fechaRegistro": "09/08/2023",
        "correo": "alepro11@gmail.com",
        "activo": 1,
        "persona": persona3
    };
    
    let persona4 = {
        "idPersona": "4",
        "nombre": "Jorge Luis",
        "apellidoPaterno": "Aguayo",
        "apellidoMaterno": "López",
        "genero": "Maculino",
        "fechaNacimiento": "19/",
        "rfc": "",
        "curp": "",
        "domicilio": "",
        "codigoPostal": "",
        "ciudad": "",
        "estado": "",
        "telefono": "",
        "foto": ""
    };

    let cliente4 = {
        "idCliente": "" ,
        "fechaRegistro": "",
        "correo": "",
        "activo": 1,
        "persona": persona4
    };
    let persona5 = {
        "idPersona": "",
        "nombre": "",
        "apellidoPaterno": "",
        "apellidoMaterno": "",
        "genero": "",
        "fechaNacimiento": "",
        "rfc": "",
        "curp": "",
        "domicilio": "",
        "codigoPostal": "",
        "ciudad": "",
        "estado": "",
        "telefono": "",
        "foto": ""
    };

    let cliente5 = {
        "idCliente": "" ,
        "fechaRegistro": "",
        "correo": "",
        "activo": 1,
        "persona": persona5
        
        
    };
    let persona6 = {
        "idPersona": "",
        "nombre": "",
        "apellidoPaterno": "",
        "apellidoMaterno": "",
        "genero": "",
        "fechaNacimiento": "",
        "rfc": "",
        "curp": "",
        "domicilio": "",
        "codigoPostal": "",
        "ciudad": "",
        "estado": "",
        "telefono": "",
        "foto": ""
    };

    let cliente6 = {
        "idCliente": "" ,
        "fechaRegistro": "",
        "correo": "",
        "activo": 1,
        "persona": persona6
    };
    
    let persona7 = {
        "idPersona": "",
        "nombre": "",
        "apellidoPaterno": "",
        "apellidoMaterno": "",
        "genero": "",
        "fechaNacimiento": "",
        "rfc": "",
        "curp": "",
        "domicilio": "",
        "codigoPostal": "",
        "ciudad": "",
        "estado": "",
        "telefono": "",
        "foto": ""
    };

    let cliente7 = {
        "idCliente": "" ,
        "fechaRegistro": "",
        "correo": "",
        "activo": 1,
        "persona": persona7
    };
    
    let persona8 = {
        "idPersona": "",
        "nombre": "",
        "apellidoPaterno": "",
        "apellidoMaterno": "",
        "genero": "",
        "fechaNacimiento": "",
        "rfc": "",
        "curp": "",
        "domicilio": "",
        "codigoPostal": "",
        "ciudad": "",
        "estado": "",
        "telefono": "",
        "foto": ""
    };

    let cliente8 = {
        "idCliente": "" ,
        "fechaRegistro": "",
        "correo": "",
        "activo": 1,
        "persona": persona8
    };
    
    let persona9 = {
        "idPersona": "",
        "nombre": "",
        "apellidoPaterno": "",
        "apellidoMaterno": "",
        "genero": "",
        "fechaNacimiento": "",
        "rfc": "",
        "curp": "",
        "domicilio": "",
        "codigoPostal": "",
        "ciudad": "",
        "estado": "",
        "telefono": "",
        "foto": ""
    };

    let cliente9 = {
        "idCliente": "" ,
        "fechaRegistro": "",
        "correo": "",
        "activo": 1,
        "persona": persona9
    };
    
    let persona10 = {
        "idPersona": "",
        "nombre": "",
        "apellidoPaterno": "",
        "apellidoMaterno": "",
        "genero": "",
        "fechaNacimiento": "",
        "rfc": "",
        "curp": "",
        "domicilio": "",
        "codigoPostal": "",
        "ciudad": "",
        "estado": "",
        "telefono": "",
        "foto": ""
    };

    let cliente10 = {
        "idCliente": "" ,
        "fechaRegistro": "",
        "correo": "",
        "activo": 1,
        "persona": persona10
    };
    
    clientes[0] = cliente1;
    clientes[1] = cliente2;
    clientes[2] = cliente3;
    clientes[3] = cliente4;
    clientes[4] = cliente5;
    clientes[5] = cliente6;
    clientes[6] = cliente7;
    clientes[7] = cliente8;
    clientes[8] = cliente9;
    clientes[9] = cliente10;

    cargarTablaCliente();
}
;

function cargarTablaCliente() {
    let datosTabla = "";
    for (let i = 0; i < clientes.length; i++) {
        let nombreC = clientes[i].persona.nombre +
                " " + clientes[i].persona.apellidoPaterno +
                " " + clientes[i].persona.apellidoMaterno;
        let datosP = "Género: " + clientes[i].persona.genero +
                " Fecha de Nacimiento: " + clientes[i].persona.fechaNacimiento +
                " RFC: " + clientes[i].persona.rfc +
                " CURP: " + clientes[i].persona.curp;
        let contacto = "Domicilio: " + clientes[i].persona.domicilio +
                " Codigo Postal: " + clientes[i].persona.codigoPostal +
                " Ciudad: " + clientes[i].persona.ciudad +
                " Estado: " + clientes[i].persona.estado +
                " Teléfono" + clientes[i].persona.telefono;
        let activo = "";
        if (clientes[i].activo == 1) {
            activo = "Activo";
        } else {
            activo = "Inactivo";
        }

        datosTabla += "<tr>";
        datosTabla += "<td>" + clientes[i].idCliente + "</td>";
        datosTabla += "<td>" + nombreC + "</td>";
        datosTabla += "<td>" + datosP + "</td>";
        datosTabla += "<td>" + clientes[i].fechaRegistro + "</td>";
        datosTabla += "<td>" + clientes[i].correo + "</td>";
        datosTabla += "<td>" + contacto + "</td>";
        datosTabla += "<td>" + activo + "</td>";
        datosTabla += "<td>" + clientes[i].persona.foto + "</td>";
        datosTabla += "<td><button type='button' class='btn btn-danger ms-2 me-2' onclick='eliminarCli(" + i + ");'> <i class='fa-solid fa-trash-can'></i></button> </td>";
        datosTabla += "<td><button type='button' class='btn btn-warning ms-2 me-2' onclick='modificarCli(" + i + ");'> <i class='fa-solid fa-down-left-and-up-right-to-center'></i> </button> </td>";
        datosTabla += "</tr>";
    }
    document.getElementById("tbClientes").innerHTML = datosTabla;
}

function buscarCliente() {
    //Tomamos el valor de la busqueda
    var b = document.getElementById("txtBusquedaCli").value;
    // Arreglo para colocar los indices de donde se encontraron datos
    var incidencias = [];

    for (var i = 0; i < clientes.length; i++) {
        if (clientes[i].persona.idPersona == b || clientes[i].persona.nombre == b
                || clientes[i].persona.apellidoPaterno == b || clientes[i].persona.apellidoMaterno == b
                || clientes[i].persona.genero == b || clientes[i].persona.fechaNacimiento == b
                || clientes[i].persona.rfc == b || clientes[i].persona.curp == b
                || clientes[i].persona.domicilio == b || clientes[i].persona.codigoPostal == b
                || clientes[i].persona.ciudad == b || clientes[i].persona.estado == b
                || clientes[i].persona.telefono == b || clientes[i].idCliente == b
                || clientes[i].fechaRegistro == b || clientes[i].correo == b
                )
        {
            //Se toma el tamaño del arreglo de incidencias
            var pos = incidencias.length;
            //En esa posicion se agrega el indice del arreglo de Empleados donde se encuentra el valor
            incidencias[pos] = i;
        }

    }
    let datosTabla = "";

    //Si hay datos que coinciden en la busqueda se genera la tabla de resultados
    if (incidencias.length > 0) {
        for (let i = 0; i < incidencias.length; i++) {
            let nombreC = clientes[incidencias[i]].persona.nombre +
                    " " + clientes[incidencias[i]].persona.apellidoPaterno +
                    " " + clientes[incidencias[i]].persona.apellidoMaterno;
            let datosP = "Género: " + clientes[incidencias[i]].persona.genero + "\n" +
                    " Fecha de Nacimiento: " + clientes[incidencias[i]].persona.fechaNacimiento + "\n" +
                    " RFC: " + clientes[incidencias[i]].persona.rfc + "\n" +
                    " CURP: " + clientes[incidencias[i]].persona.curp;
            let contacto = "Domicilio: "+clientes[incidencias[i]].persona.domicilio +
                    " Código Postal: " + clientes[incidencias[i]].persona.codigoPostal +
                    " Ciudad: " + clientes[incidencias[i]].persona.ciudad +
                    " Estado: " + clientes[incidencias[i]].persona.estado +
                    " Teléfono" + clientes[incidencias[i]].persona.telefono;
            let activo = "";
            if (clientes[incidencias[i]].activo == 1) {
                activo = "Activo";
            } else {
                activo = "Inactivo";
            }

            datosTabla += "<tr>";
            datosTabla += "<td>" + clientes[incidencias[i]].idCliente + "</td>";
            datosTabla += "<td>" + nombreC + "</td>";
            datosTabla += "<td>" + datosP + "</td>";
            datosTabla += "<td>" + clientes[incidencias[i]].correo + "</td>";
            datosTabla += "<td>" + clientes[incidencias[i]].fechaRegistro + "</td>";
            datosTabla += "<td>" + contacto + "</td>";
            datosTabla += "<td>" + activo + "</td>";
            datosTabla += "<td>" + clientes[incidencias[i]].persona.foto + "</td>";
            datosTabla += "<td><button type='button' class='btn btn-danger ms-2 me-2' onclick='eliminarEmp(" + incidencias[i] + ");'> <i class='fa-solid fa-trash-can'></i></button> </td>";
            datosTabla += "<td><button type='button' class='btn btn-warning ms-2 me-2' onclick='modificarEmp(" + incidencias[i] + ");'> <i class='fa-solid fa-down-left-and-up-right-to-center'></i> </button> </td>";
            datosTabla += "</tr>";
        }
    } else {
        datosTabla = "<tr><td colspan='5'>No hay incidencias de la busqueda</td></tr>";
    }
    document.getElementById("tbClientes").innerHTML = datosTabla;
}

function buscarClientesId()
{
    let pos;
    let id = parseInt(document.getElementById("txtIdClientes").value);

    for (let i = 0; i < clientes.length; i++) {
        if (id == clientes[i].idEmpleado) {
            pos = i;
        }
    }
    eliminarEmp(pos);
}

function eliminarCli(i)
{
    clientes.splice(i, 1);
    cargarTablaCliente();
    limpiarCli();
}

function modificarCli(i) {
    //DATOS DE PERSONA    
    document.getElementById("txtIdCliente").value = clientes[i].idCliente;
    document.getElementById("txtIdPersona").value = clientes[i].persona.idPersona;
    document.getElementById("nombre").value = clientes[i].persona.nombre;
    document.getElementById("apellido-paterno").value = clientes[i].persona.apellidoPaterno;
    document.getElementById("apellido-materno").value = clientes[i].persona.apellidoMaterno;
    document.getElementById("fecha-nacimiento").value = clientes[i].persona.fechaNacimiento;
    document.getElementById("rfc").value = clientes[i].persona.rfc;
    document.getElementById("curp").value = clientes[i].persona.curp;
    document.getElementById("domicilio").value = clientes[i].persona.domicilio;
    document.getElementById("codigo-postal").value = clientes[i].persona.codigoPostal;
    document.getElementById("ciudad").value = clientes[i].persona.ciudad;
    document.getElementById("estado").value = clientes[i].persona.estado;
    document.getElementById("telefono").value = clientes[i].persona.telefono;
    //DATOS DE EMPLEADO
    document.getElementById("fecha-registro").value = clientes[i].fechaRegistro;
    document.getElementById("correo").value = clientes[i].correo;
    document.getElementById("estatus").value = parseFloat(clientes[i].persona.activo);
}

function limpiarCli() {
    //DATOS DE PERSONA    
    document.getElementById("txtIdCliente").value = "";
    document.getElementById("txtIdPersona").value = "";
    document.getElementById("nombre").value = "";
    document.getElementById("apellido-paterno").value = "";
    document.getElementById("apellido-materno").value = "";
    document.getElementById("fecha-nacimiento").value = "";
    document.getElementById("rfc").value = "";
    document.getElementById("curp").value = "";
    document.getElementById("domicilio").value = "";
    document.getElementById("codigo-postal").value = "";
    document.getElementById("ciudad").value = "";
    document.getElementById("estado").value = "";
    document.getElementById("telefono").value = "";
    //DATOS DE EMPLEADO
    document.getElementById("txtFechaIngreso").value = "";
    document.getElementById("txtEstatus").value = "";
}

function guardarCli()
{

    let idE = parseInt(document.getElementById("txtIdCliente").value);
    let idP = parseInt(document.getElementById("txtIdPersona").value);
    let nom = document.getElementById("nombre").value;
    let app = document.getElementById("apellido-paterno").value;
    let apm = document.getElementById("apellido-materno").value;
    let fn = document.getElementById("fecha-nacimiento").value;
    let rfc = document.getElementById("rfc").value;
    let curp = document.getElementById("curp").value;
    let dom = document.getElementById("domicilio").value;
    let cp = document.getElementById("codigo-postal").value;
    let ciu = document.getElementById("ciudad").value;
    let edo = document.getElementById("estado").value;
    let tel = document.getElementById("telefono").value;

    let genRadio = document.querySelector('input[name="genero"]:checked');
    let gen = genRadio ? genRadio.value : "";

    let foto = "";
    //document.getElementById("cmbGenero").value;
    //DATOS DE EMPLEADO
    let fr = document.getElementById("fecha-registro").value;
    let correo = document.getElementById("correo").value;
    let est = document.getElementById("estatus").value;

    let persona1 = {
        "idPersona": idP,
        "nombre": nom,
        "apellidoPaterno": app,
        "apellidoMaterno": apm,
        "genero": gen,
        "fechaNacimiento": fn,
        "rfc": rfc,
        "curp": curp,
        "domicilio": dom,
        "codigoPostal": cp,
        "ciudad": ciu,
        "estado": edo,
        "telefono": tel,
        "foto": foto
    };

    let empleado1 = {
        "idEmpleado": idE,
        "fechaIngreso": fr,
        "puesto": correo,
        "activo": est,
        "persona": persona1
    };

    alert(idE);

    //modificar 
    if (idE != 0)
    {
        let pos;
        for (let i = 0; i < clientes.length; i++) {
            if (idE == clientes[i].idCliente) {
                pos = i;
            }
        }
        alert(pos);
        clientes[pos] = empleado1;
    }
    //es nuevo generar ids
    else {
        let id = (clientes.length) + 1;
        empleado1.idCliente = id;
        empleado1.persona.idPersona = id;
        let pos = clientes.length;
        clientes[pos] = empleado1;
    }

    cargarTablaCliente();

}

let inputFile = null;

function leerFoto()
{
    inputFile = document.getElementById("inputFileImagen");
    inputFile.onchange = function (evt) {
        cargarFotografia(inputFile);
    };
}

function cargarFotografia(objetoInputFile)
{
    //Revisamos que el usuario haya seleccionado un archivo:
    if (objetoInputFile.files && objetoInputFile.files[0])
    {
        let reader = new FileReader();
        //Agregamos un oyente al lector del archivo para que,
        //en cuanto el usuario cargue una imagen, esta se lea
        //y se convierta de forma automatica en una cadena de Base64:
        reader.onload = function (e)
        {
            let fotoB64 = e.target.result;
            document.getElementById("imgFoto").src = fotoB64;
            document.getElementById("txtaCodigoImagen").value = fotoB64;
//            document.getElementById("txtaCodigoImagen").value = 
//                    fotoB64.substring(fotoB64.indexOf(",") + 1,
//            fotoB64.length);
        };
        //Leemos el archivo que selecciono el usuario y lo
        //convertimos en una cadena con la Base64:
        reader.readAsDataURL(objetoInputFile.files[0]);            
        }
}

